<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Interactive MapReduce: The Factory</title>
    <style>
        body { font-family: 'Courier New', monospace; background: #f4f4f4; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        
        /* The Zones */
        .zone { 
            background: white; 
            border: 2px solid #333; 
            margin-bottom: 20px; 
            padding: 20px; 
            border-radius: 8px;
            box-shadow: 4px 4px 0px #aaa;
        }
        h2 { border-bottom: 2px solid #333; padding-bottom: 10px; }
        
        /* Interactive Elements */
        .data-packet {
            display: inline-block;
            background: #ffeba7;
            border: 1px solid #d4a017;
            padding: 5px 10px;
            margin: 5px;
            font-weight: bold;
            transition: all 0.5s ease;
        }
        
        .reducer-bin {
            border: 2px dashed #666;
            padding: 10px;
            margin: 10px 0;
            min-height: 50px;
        }

        button {
            background: #333; color: white; border: none; padding: 10px 20px; 
            font-size: 16px; cursor: pointer;
        }
        button:hover { background: #555; }
    </style>
</head>
<body>

<div class="container">
    <h1>MapReduce: Under the Hood</h1>
    <p><i>Input a sentence to see how a cluster of machines counts words.</i></p>

    <div class="zone" id="input-zone">
        <h2>1. Input Split</h2>
        <textarea id="inputText" rows="3" style="width: 100%; font-size: 18px;">apple banana apple carrot banana apple</textarea>
        <br><br>
        <button onclick="runMap()">Run Map Phase</button>
    </div>

    <div class="zone" id="map-zone">
        <h2>2. Map Phase (Local Processing)</h2>
        <p>Workers break text into (Key, Value) pairs.</p>
        <div id="map-output"></div>
    </div>

    <div class="zone" id="shuffle-zone">
        <h2>3. Shuffle & Sort (The Magic)</h2>
        <p>The system groups all identical keys together.</p>
        <button onclick="runShuffle()">Run Shuffle</button>
        <div id="shuffle-output"></div>
    </div>

    <div class="zone" id="reduce-zone">
        <h2>4. Reduce Phase (Aggregation)</h2>
        <p>Reducers sum up the lists.</p>
        <button onclick="runReduce()">Run Reduce</button>
        <div id="reduce-output"></div>
    </div>
</div>

<script>
    // DATA STORE
    let mapResults = [];
    let shuffleResults = {};

    // --- PHASE 1: MAP ---
    function runMap() {
        const text = document.getElementById('inputText').value;
        const words = text.trim().split(/\s+/);
        const container = document.getElementById('map-output');
        container.innerHTML = '';
        mapResults = [];

        words.forEach((word, index) => {
            // Simulate distributed delay
            setTimeout(() => {
                const packet = document.createElement('div');
                packet.className = 'data-packet';
                packet.innerText = `("${word}", 1)`;
                container.appendChild(packet);
                
                // Store purely for logic
                mapResults.push({ key: word, val: 1 });
            }, index * 200); // Staggered animation
        });
    }

    // --- PHASE 2: SHUFFLE ---
    function runShuffle() {
        const container = document.getElementById('shuffle-output');
        container.innerHTML = '';
        shuffleResults = {};

        // Group by Key
        mapResults.forEach(item => {
            if (!shuffleResults[item.key]) {
                shuffleResults[item.key] = [];
            }
            shuffleResults[item.key].push(item.val);
        });

        // Visualize Bins
        for (const [key, values] of Object.entries(shuffleResults)) {
            const bin = document.createElement('div');
            bin.className = 'reducer-bin';
            bin.innerHTML = `<strong>Bin for "${key}":</strong> `;
            
            // Create the list visual: [1, 1, 1]
            const listVisual = document.createElement('span');
            listVisual.className = 'data-packet';
            listVisual.innerText = `[${values.join(', ')}]`;
            bin.appendChild(listVisual);
            
            container.appendChild(bin);
        }
    }

    // --- PHASE 3: REDUCE ---
    function runReduce() {
        const container = document.getElementById('reduce-output');
        container.innerHTML = '';

        for (const [key, values] of Object.entries(shuffleResults)) {
            // THE USER LOGIC: Summing the array
            const sum = values.reduce((a, b) => a + b, 0);

            const result = document.createElement('div');
            result.className = 'data-packet';
            result.style.backgroundColor = '#a7ffeb'; // Different color for final output
            result.innerText = `("${key}", ${sum})`;
            container.appendChild(result);
        }
    }
</script>

</body>
</html>
