<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Spotlight: Basic Attention</title>
    <style>
        :root {
            --bg: #111827;
            --card: #1f2937;
            --text: #f3f4f6;
            --accent: #60a5fa; /* Blue */
            --highlight: #facc15; /* Yellow */
            --muted: #9ca3af;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); padding: 20px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        
        h2 { margin-bottom: 5px; color: var(--accent); }
        p { color: var(--muted); margin-bottom: 30px; text-align: center; max-width: 600px; }

        /* Input Area */
        .input-area { background: var(--card); padding: 15px; border-radius: 12px; display: flex; gap: 10px; margin-bottom: 40px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        input { background: #374151; border: 1px solid #4b5563; color: white; padding: 10px; border-radius: 6px; width: 300px; font-size: 1rem; }
        button { background: var(--accent); color: #000; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; }

        /* The Sentence Stage */
        .stage-container { position: relative; width: 100%; max-width: 900px; height: 300px; display: flex; justify-content: center; align-items: center; }
        
        /* SVG Layer (Behind words) */
        svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }
        path { fill: none; stroke-linecap: round; transition: all 0.4s ease; }

        /* Words */
        .words-row { display: flex; gap: 40px; z-index: 2; position: relative; }
        
        .token {
            background: var(--card); padding: 12px 20px; border-radius: 8px; border: 2px solid #374151;
            cursor: pointer; transition: all 0.3s; font-size: 1.1rem; user-select: none; position: relative;
        }
        .token:hover { transform: translateY(-3px); border-color: var(--muted); }
        
        /* State: Active Query (The Source) */
        .token.query {
            background: var(--accent); color: #000; border-color: var(--accent);
            box-shadow: 0 0 20px rgba(96, 165, 250, 0.5); transform: scale(1.1);
        }
        
        /* State: Target Key (The Destination) */
        .token.key { border-color: var(--highlight); color: white; }
        
        /* Score Badge on Keys */
        .score-badge {
            position: absolute; top: -30px; left: 50%; transform: translateX(-50%);
            background: var(--highlight); color: #000; font-size: 0.8rem; font-weight: bold;
            padding: 2px 6px; border-radius: 4px; opacity: 0; transition: opacity 0.3s;
            white-space: nowrap; pointer-events: none;
        }
        .token.key .score-badge { opacity: 1; }

        /* Explanation Box */
        .explainer {
            margin-top: 20px; background: var(--card); padding: 20px; border-radius: 12px; width: 100%; max-width: 600px;
            border-left: 5px solid var(--accent); min-height: 100px; transition: opacity 0.2s;
        }
        .explainer strong { color: var(--accent); }
    </style>
</head>
<body>

    <h2>Interactive Attention Spotlight</h2>
    <p>Click on any word to act as the <strong>Query</strong> (the searcher). <br>See which other words light up as <strong>Keys</strong> (the matches).</p>

    <div class="input-area">
        <input type="text" id="inputText" value="The animal did not cross it">
        <button onclick="init()">Load Sentence</button>
    </div>

    <div class="stage-container">
        <svg id="connections"></svg>
        <div class="words-row" id="wordsContainer">
            </div>
    </div>

    <div class="explainer" id="explainer">
        <div style="opacity: 0.5; text-align: center;">Click a word above to see how it attends to others.</div>
    </div>

<script>
    // --- Configuration ---
    let words = [];
    let activeIndex = null;

    // --- Logic: "Fake" Attention for Educational Purposes ---
    // In a real model, these are dot products. Here, we use heuristics to show *what a model usually learns*.
    function getAttentionScore(queryIdx, targetIdx, queryWord, targetWord) {
        // 1. Self-Attention: Words always attend to themselves heavily (Identity)
        if (queryIdx === targetIdx) return 0.8;

        const q = queryWord.toLowerCase();
        const t = targetWord.toLowerCase();

        // 2. Grammar: "The" looks for nouns
        if (q === 'the' && (t === 'animal' || t === 'street')) return 0.7;

        // 3. Pronoun Resolution: "It" looks for the subject ("animal")
        if (q === 'it' && t === 'animal') return 0.95; // The "Aha!" moment
        if (q === 'it' && t === 'street') return 0.1;  // Low score

        // 4. Negation: "not" looks at the verb "cross"
        if (q === 'not' && t === 'cross') return 0.8;

        // 5. Verbs looking for objects: "cross" looks for "street"
        if (q === 'cross' && t === 'street') return 0.6;

        // Default: Low background noise
        return 0.05; 
    }

    // --- setup ---
    function init() {
        const text = document.getElementById('inputText').value;
        words = text.trim().split(/\s+/);
        const container = document.getElementById('wordsContainer');
        container.innerHTML = '';
        
        // Reset
        document.getElementById('connections').innerHTML = '';
        document.getElementById('explainer').innerHTML = '<div style="opacity: 0.5; text-align: center;">Click a word above to start.</div>';
        activeIndex = null;

        words.forEach((w, i) => {
            const btn = document.createElement('div');
            btn.className = 'token';
            btn.innerText = w;
            
            // Score Badge (Hidden by default)
            const badge = document.createElement('div');
            badge.className = 'score-badge';
            badge.innerText = '0%';
            btn.appendChild(badge);

            btn.onclick = () => activateWord(i);
            container.appendChild(btn);
        });
    }

    // --- Core Interaction ---
    function activateWord(index) {
        activeIndex = index;
        const tokens = document.querySelectorAll('.token');
        const svg = document.getElementById('connections');
        svg.innerHTML = ''; // Clear lines

        let maxScore = 0;
        let maxWord = '';

        // 1. Update Word Styles
        tokens.forEach((t, i) => {
            t.className = 'token'; // Reset
            
            if (i === index) {
                t.classList.add('query'); // Highlight Source
            } else {
                // Calculate Score
                const score = getAttentionScore(index, i, words[index], words[i]);
                const percentage = Math.round(score * 100);
                
                // Update Badge
                t.querySelector('.score-badge').innerText = percentage + '%';
                
                // If relevant, style as Key
                if (score > 0.1) {
                    t.classList.add('key');
                    drawCurve(index, i, score);
                    
                    if (score > maxScore) {
                        maxScore = score;
                        maxWord = words[i];
                    }
                }
            }
        });

        // 2. Explain it
        explain(words[index], maxWord, maxScore);
    }

    // --- Visualization: Draw Smooth Curves ---
    function drawCurve(fromIdx, toIdx, strength) {
        const tokens = document.querySelectorAll('.token');
        const svg = document.getElementById('connections');
        const stage = document.querySelector('.stage-container').getBoundingClientRect();

        const fromRect = tokens[fromIdx].getBoundingClientRect();
        const toRect = tokens[toIdx].getBoundingClientRect();

        // Coordinates relative to SVG container
        const x1 = fromRect.left + fromRect.width / 2 - stage.left;
        const y1 = fromRect.top - stage.top; // Start from top of word
        const x2 = toRect.left + toRect.width / 2 - stage.left;
        const y2 = toRect.top - stage.top;

        // Arc height depends on distance
        const dist = Math.abs(fromIdx - toIdx);
        const arcHeight = 40 + (dist * 20); 

        // SVG Path (Quadratic Bezier)
        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
        const d = `M ${x1} ${y1} Q ${(x1 + x2) / 2} ${y1 - arcHeight} ${x2} ${y2}`;
        
        path.setAttribute("d", d);
        path.setAttribute("stroke", "#facc15"); // Yellow
        path.setAttribute("stroke-width", strength * 8); // Thickness = Attention
        path.setAttribute("stroke-opacity", strength);
        
        svg.appendChild(path);
    }

    // --- Narrative Box ---
    function explain(query, topMatch, score) {
        const box = document.getElementById('explainer');
        
        if (score < 0.2) {
            // Looking at itself mostly
            box.innerHTML = `
                <div><strong>Query:</strong> "${query}"</div>
                <div style="margin-top:5px">It is mostly paying attention to <strong>itself</strong>. This is normal when a word's own meaning is enough context.</div>
            `;
            return;
        }

        box.innerHTML = `
            <div><strong>Query (The Searcher):</strong> "${query}"</div>
            <div style="margin-top:10px; font-size: 1.1em;">
                I found context in: <strong style="color: #facc15">"${topMatch}"</strong> (${(score*100).toFixed(0)}% match)
            </div>
            <div style="margin-top:5px; color: #9ca3af; font-size: 0.9em;">
                <i>Meaning Update:</i> The math will now mix the meaning of "${topMatch}" into "${query}" so the model understands them together.
            </div>
        `;
    }

    // Start
    window.onload = init;
</script>

</body>
</html>
